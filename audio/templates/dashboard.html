{% extends "layout.html" %}
{% block title %}Dashboard | Sound Remover{% endblock %}
{% block content %}

<div class="container py-4">
    <h2 class="fw-bold mb-3">üéß Welcome, {{ request.user.username }}</h2>

    <!-- Section 1: Profile -->
    <div class="card bg-dark text-light border-light shadow-sm mb-4" style="border-radius: 1rem;">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <p class="mb-1"><strong>Username:</strong> {{ request.user.username }}</p>
                <p class="mb-1"><strong>Tickets:</strong> {{ profile.tickets }}</p>
                <p class="mb-1"><strong>Name:</strong> {{ profile.user.first_name }} {{ profile.user.last_name }}</p>
            </div>
            <div>
                <a href="{% url 'buy_ticket' %}" class="btn btn-success me-2">üí≥ ‡∏ã‡∏∑‡πâ‡∏≠ Ticket ‡πÄ‡∏û‡∏¥‡πà‡∏°</a>
                <a href="{% url 'edit_profile' %}" class="btn btn-warning">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                <a href="{% url 'change_password' %}" class="btn btn-primary me-2">üîí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</a>
            </div>
        </div>
    </div>

    <!-- Section 2: Audio File History -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="fw-bold mb-3">üéµ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</h5>

            {% if audio_files %}
            <table class="table table-striped align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡πÅ‡∏ó‡πá‡∏Å</th>
                        <th>‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå</th>
                    </tr>
                </thead>
                <tbody>
                    {% for audio in audio_files %}
                    <tr>
                        <td>{{ audio.original_file.name|cut:"uploads/originals/" }}</td>
                        <td>{{ audio.uploaded_at|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if audio.status == "processed" %}
                            <span class="badge bg-success">Processed</span>
                            {% elif audio.status == "pending" %}
                            <span class="badge bg-warning text-dark">Pending</span>
                            {% else %}
                            <span class="badge bg-danger">Failed</span>
                            {% endif %}
                        </td>
                        <td>
                            {% for tag in audio.tags.all %}
                            <span class="badge bg-secondary">{{ tag.name }}</span>
                            {% empty %}
                            <span class="text-muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ó‡πá‡∏Å</span>
                            {% endfor %}
                        </td>
                        <td>
                            {% if not request.user.is_staff %}
                            <a href="{% url 'audio_detail' audio.id %}" class="btn btn-outline-primary btn-sm">View
                                File</a>
                            {% else %}
                            <a href="{% url 'admin_view_audio' profile.user.id audio.id %}"
                                class="btn btn-outline-primary btn-sm">View File</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</p>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}